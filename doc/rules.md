# 游戏规则说明

## 地图元素
地图采用 MapSize * MapSize 的矩阵棋盘式地图，方格有水下（下/0）、水面（中/1）、
空中（上/2）三个层次。同一格子的同一层次同时只能被一个单位占据。

地形：海洋、陆地

### 海洋
相当于空地，上中下层分别可停留一个单位。

### 陆地
建筑和资源点均在陆地地形上，陆地地形只有空中可停留单位。


## 单位共有属性
基本单位包括建筑（基地、据点）和可移动单位。

基本属性：

|       属性       |     变量名     |                                  备注                                 |
|------------------|----------------|-----------------------------------------------------------------------|
| 队伍             | team           | 0或1，据点该属性取2表示尚未被占领                                     |
| 形状             | size           | Rectangle实例，表示该单位的形状。一般为1×1，但如基地形状可能为3×3矩形 |
| 位置             | pos            | 单位占据矩形的左上顶点                                                |
| 视野范围         | sight_range[3] | 对三层的视野范围                                                      |
| 射程             | fire_range[3]  | 对三层的射程                                                          |
| 生命值           | health         |                                                                       |
| 生命值上限       | health_max     |                                                                       |
| 燃料             | fuel           |                                                                       |
| 燃料上限         | fuel_max       |                                                                       |
| 弹药             | ammo           |                                                                       |
| 弹药上限         | ammo_max       |                                                                       |
| 单次攻击消耗弹药 | ammo_once      |                                                                       |
| 金属             | metal          |                                                                       |
| 金属上限         | metal_max      |                                                                       |
| 攻击力           | attack[2]      | attack[0],[1]分别表示火炮攻击力和鱼雷攻击力                           |
| 防御力           | defence[2]     | defence[0],[1]分别表示对火炮和对鱼雷防御力                            |
| 速度             | speed          | 单回合内最大移动格数                                                  |
| 造价             | cost           | 生产该单位所需的金属                                                  |
| 生产所需回合     | build_round    | 生产该单位需要的回合数                                                |
| 人口             | population     | 一个该单位占有的人口数（有人口数上限）                                |


## 游戏模式
每回合前选手为己方所有单位设定命令，命令包括原地指令和移动目的地。

原地指令包括：待命PASS（原地指令为空，不代表不移动）、攻击ATTACK、补给SUPPLY、采集COLLECT、
维修FIX、自爆EXPLODE（ORZ…这个指令先留着）、生产PRODUCE

移动目的地：不更改则单位自动保持上回合设定的目的地继续前进，若更改为当前位置则表示不移动

回合内先结算原地指令，结算完成后再移动，但指令均在回合开始前设定

### 距离
    abs(X1-X2)+ abs(Y1-Y2)

### 积分
    总积分 = 对敌伤害积分 + 占领岛屿积分（每回合奖励）+ 采集资源积分

### 初始条件
双方所有单位（包括基地）资源充满，满血。岛屿满血无主。

### 胜利条件
摧毁对方基地，或回合达到回合数上限时积分较高者获胜

### 视野范围
地形全可见（海洋、基地、岛屿、油田、矿场），每个单位均有三层视野范围，己方单位共享视野范围

### 关于天气
天气weather为在游戏开始就确定的数据，该数据影响所有单位的视野，即

    实际视野 = 固有视野 + weather。

如果出现单位视野受影响至0或负，则该单位只能看到同位置不同层次的敌人。

### 资源点
资源点分为油田和矿场，均在陆地地形上。

### 油田
不可攻击，油储备总量fuel_max，双方基地附近各有一小油田，地图的中间区域可设大油田，
油田储备的燃料只能由运输舰收集获得（不可攻占，但可以派单位在周围保证运输舰运输安全）。

### 矿场
不可攻击，金属储备总量metal_max，双方基地附近各有一小矿场，地图的中间区域可设
大矿场，矿场储备的金属只能由运输舰收集获得（不可攻占，但可以派单位在周围保证运输舰运输安全）。


## 建筑
### 基地 Base
#### 指令
攻击、补给、维修、生产

#### 其他说明
基地不可移动，不可维修，即生命值无法恢复。弹药无限，只能造成和接受火炮杀伤。

### 据点 Fort
#### 指令
攻击、补给
#### 其他说明
游戏开始时，所有岛屿均为无主状态，无主状态岛屿无燃料和弹药储备，故无攻击能力。双方可以对
岛屿发动攻击，当岛屿的生命值降为0时，岛屿的所有权归于使岛屿生命力降为0的攻击发出方。岛屿
被占领后，生命值立即回满，占领方可通过运输舰向岛屿运输资源，也可将岛屿的资源运往其他地方。
只有占领方可以控制岛屿进行攻击或补给。攻下对方的岛屿后，对方剩余的资源不消失，转为己方岛屿
的资源可任意利用。只能造成和接受火炮杀伤。可将金属暂时储存在据点，但金属只有在基地才能发挥作用！


## 可移动单位
### 水面及水下单位
潜艇Submarine、驱逐舰Destroyer、巡洋舰Cruiser、战列舰Battleship、
航空母舰Carrier、运输舰Cargo

#### 指令（除航母、运输舰）
攻击、自爆
#### 航母指令
攻击、补给、自爆
#### 运输舰指令
补给、采集、自爆
#### 其他说明
潜艇只能造成和接受鱼雷伤害

### 飞机（机群）Formation
####指令
攻击、自爆（主动坠机或与空中单位相撞）

下文还有对可移动单位更详尽的介绍~


## 操作说明
### 移动
移动时只能在同一层次内移动，且移动时不能穿越同层其他单位，同层单位亦不能堆叠于同一格。每
移动一格消耗一单位燃料，燃料<=0则不能继续移动。特别地，若飞机编队燃料降至零，则坠毁（相当于
自爆操作），并对当前坐标的1层（水面）单位造成一定伤害。若飞机编队未发生实际移动（可能发出了
移动指令但并未成功），则视为原地盘旋一回合，同样要消耗一单位燃料。
#### 特殊情况
当某两个同层单位单回合目的地为同一坐标时，速度Speed大的单位移动成功，移动未成功的单位停留在
前一格不能继续移动，若两单位速度相同，则采取随机的方式决定哪个单位移动成功。

### 攻击
攻击包括火力伤害和鱼雷伤害.潜艇只造成和接受鱼雷伤害，陆地建筑只造成和接受火力伤害，飞机不能
接受鱼雷伤害

攻击在移动前发动，具有溅射效果。攻击时需指定攻击的操作对象索引号，即攻击地图中
其坐标,产生的攻击效果只对目标该层有效。如果该坐标不在该单位的相应视野范围内，则返回错误值，
视为放弃此次攻击。弹药量<=0时不能发动攻击。弹药在回合开始时到达该坐标产生伤害（闪避概率
与距离有关）。

### 补给
运输舰、航母、岛屿、基地特有指令，航母、岛屿、基地可以对任意单位补给，运输舰不能补给飞机。
补给在移动结束后发动，同样需指定补给目标坐标，对空补给距离为0，对水面补给距离为1，对水下补给
距离为0或1(这是个啥就是距离是1也可以补给，在自己身子低下也可以补给)。超出范围则视为放弃补给。
每次补给补满对方容量，若剩余量不足以补满对方，则全部补充给对方。（警告：运输舰、航母需要保留
一些燃料供自己使用，否则会导致抛锚）（这个不用选手操心，补给时会有限定）

### 收集
运输舰特有指令，从岛屿或资源点获取资源，每次收集补满运输舰容量。收集距离为1。

### 维修
基地特有指令，对空维修距离为0，其余维修距离为1，一次只能维修一个单位，维修补满生命值，补满弹药
及燃料。若被维修单位为飞机，则类似于生产操作，可选择维修后的编队配置方案。

### 生产 Build
基地特有指令，给出各单位对应的编号，若生产飞机编队，还需给出编队配置方案。生产后自动附加
补给操作。生产出的单位在到基地距离为1的对应层次随机出生。生产消耗金属（后续补给操作该消耗什么
消耗什么= =），也需要一定的回合数。之后的生产过程并不影响基地的其他操作。


## 单位详解
### 飞机
#### 编队
地图上一个格子内的飞机并不是一架飞机，而是一个飞机编队，每个飞机编队飞机数为常量。
生产飞机时，玩家可自由安排编队内机种配置方案。编队内共四个机种：战斗机（0）、鱼雷机（1）、
轰炸机（2）、侦察机（3）。不同的配置方案会对一个飞机编队（在地图上则呈现为一个飞机单位）
的攻击、侦查范围、生命值产生影响。飞机编队不可合并。

#### 简介
机群可有很高的机动性，但是容易在劣势条件下有很大伤亡，特别是只能攻击所在位置的舰船。需要有航母
或据点的支援才能很好地续航，不然攻击次数少的可怜。愿意战略轰炸的亲们可以尝试绕远偷袭潜艇、
航母、据点和运输船（挂掉不管哦~）

战斗机可以提供大幅制空权值，鱼雷机和轰炸机提供不同种类的输出，侦察机能提供视野，以及对附近
发生的战斗产生有利作用.

#### 能力值
由于编队的具体配置方案是在生产时由玩家自主决定的，故生命值上限、视野范围、攻击力、燃料上限、
弹药上限、各机种初始数量的值只有在游戏过程中才能确定，除了初始数量，其他值还与当前生命值有关。
其中视野范围只决定于编队是否有侦察机。

#### 伤害说明
如果飞机编队受到攻击，则按侦察机、鱼雷机、轰炸机、战斗机的顺序依次扣除；飞机不能接受鱼雷伤害

### 潜艇
#### 简介
潜艇能提供成吨的伤害，并且不会被人察觉，神不知鬼不觉的解决掉看起来很叼的航母和战舰。但是本身
异常脆弱，适合突袭斩首。注意： 潜艇只能造成和接受鱼雷伤害，因而无法攻击据点。

### 船舰
#### 派生单位介绍
驱逐舰（各方面能力均衡，主要反潜和侦查护航突袭，航速高，火力较低）、巡洋舰（稍微牺牲了
移动速度，换来了攻击力提升，对空水平高超）、战舰（移动速度较慢，但是攻击防御都不逊色，就是干！
小秘密：无反潜能力）、航空母舰（移动速度最慢，兼备攻击和补给能力，有一定防御力但受到鱼雷攻击
损伤巨大，无反潜能力）、运输舰（无攻击能力，运输资源）

#### 操作
攻击（除运输舰）、补给（运输舰和航母，只有航母可以补给飞机）、收集（运输舰独有功能，从岛屿、
资源点收集资源运往其他位置）、自爆


## 伤害计算
伤害计算计算两次，分别计算火力和鱼雷伤害，弹药消耗为ammo_once
### 伤害计算公式
距离对攻方有一定影响

    修正系数 = 1 – (distance – 1) / (fire_range + 1) 

//可能大于1，近距离伤害奖励

伤害 = （攻击 – 防御）    //空对空伤害另算….

攻击 = 基本攻击力\*距离修正\*攻击方侦察机补正

防御 = 基本防御力*防御方侦察机补正

侦察机补正为常数（暂不确定）

// 潜艇只能造成和接受鱼雷伤害

// 陆地建筑只能造成和接受火力伤害

// 飞机不能接受鱼雷伤害

### 闪避
    accuracy = 1 -( (distance) / (fire_range + 1))^2

### 空对空伤害计算
    基本攻击力= （机体的雷装/火力）\*比例系数\*√搭载数

另外，空对空伤害与双方制空权值air_mastery相关。（制空权的存在是为了~~加速机群的阵亡~~
更好的还原历史）

air_mastery = 基本攻击力 + 距离为1的援助海军对空攻击力

#### 特别说明：
空军没有护甲（好吧= =），空战双方除非出现完全丧失制空权，否则都会出现损伤，但先发制人好得多~~。

### 制空权
制空权值攻击方与防守方之比决定制空权：

\>3完全制空 攻击加成1/2 攻击方不损失飞机 防守方飞机额外损失结算后的1/3

\>3/2制空权优势 攻击加成1/2 攻击方损失应损失飞机的2/3

1/2~3/2无补正

<1/2制空权劣势 攻击减少1/3 

<1/3完全丧失制空权 进攻方现有飞机再损失结算后的1/3 防守方不损失飞机 可以继续对舰攻击

