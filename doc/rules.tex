\documentclass[11pt,a4paper]{article}
\XeTeXlinebreaklocale "zh"
\XeTeXlinebreakskip = 0pt plus 1pt minus 0.1pt
\usepackage[top=1in,bottom=1in,left=1.25in,right=1.25in]{geometry}
\usepackage{float}
\usepackage{fontspec}
\newfontfamily\zhfont[BoldFont=STHeiti]{STFangsong}
\newfontfamily\zhpunctfont{STFangsong}
\setmainfont{Times New Roman}
\usepackage{indentfirst}
\usepackage{zhspacing}
\zhspacing

\usepackage{amsmath}

\title{游戏规则说明}
\author{队式16开发组}

\begin{document}

  \maketitle

  \section{地图元素}
    地图采用\texttt{MapSize} * \texttt{MapSize}的矩阵棋盘式地图，方格有水下（下/0）、水面（中/1）、空中（上/2）三个层次。同一格子的同一层次同时只能被一个单位占据。

    地形：海洋、陆地

    \begin{description}
      \item[海洋] 相当于空地，上中下层分别可停留一个单位。
      \item[陆地] 建筑和资源点均在陆地地形上，陆地地形只有空中可停留单位。
    \end{description}


  \section{建筑}
    建筑包括基地、据点（相当于原来的岛屿）。基地和据点占据一矩形区域（不一定1×1方格）。

    \subsection{基地}
    \subsection{岛屿}



  \section{单位（可移动单位）}
    可移动单位：飞机、潜艇、船舰。

    可移动单位共有属性：

    \begin{description}
      \item[\texttt{Destination[2]}] 移动目的地
      \item[\texttt{Command}] 指令
      \item[\texttt{CommandCoordinate[3]}] 指令目标坐标
    \end{description}

    可移动单位占一个格子。

    \subsection{飞机}
    \subsection{潜艇}
    \subsection{船舰}




  \section{作战系统}
    \subsection{游戏模式}
      每回合双方玩家首先为所有可移动单位设定移动目的地\texttt{Destination}，如果未设定，则按上回合的目的地继续移动。再设定本回合移动后的指令\texttt{Command}：攻击、补给、维修（每回合只能设定一条指令）。双方设定完所有指令后共同结算。

    \subsection{胜利条件}
      摧毁对方基地 或 回合数达到最大回合数\texttt{RoundMax}时，积分高的一方获胜。详见积分系统\ref{sec:score-system}。

    \subsection{距离}
      水平距离与竖直距离之和

    \subsection{初始条件}
      双方所有单位（包括基地）资源充满，满血。岛屿满血无主。

    \subsection{视野范围}
      地形全可见（海洋、基地、岛屿、油田、矿场），每个单位均有三层视野范围，己方单位共享视野范围，构成地图可见状态\texttt{FieldofVison[MapSize][MapSize][3]}，-2表示不可见，-1表示无单位，否则为单位ID。

    \subsection{移动}
      移动时只能在同一层次内移动，且移动时不能穿越同层其他单位，同层单位亦不能堆叠于同一格。每移动一格消耗一单位燃料，燃料$\leq 0$则不能继续移动。特别地，若飞机编队燃料降至零，则坠毁，并对当前坐标的1层（水面）单位造成一定伤害。若飞机编队未发生实际移动（可能发出了移动指令但并未成功），则视为原地盘旋一回合，同样要消耗一单位燃料。

      \paragraph{特殊情况}
      当某两个单位在移动过程中将通过同一坐标时，则速度\texttt{Speed}大的单位移动成功并继续移动，移动未成功的单位停留在前一格不能继续移动，若两单位速度相同，则采取随机的方式决定哪个单位移动成功。

    \subsection{攻击}
      攻击在移动结束（包括上述意外停止的情况）后发动，攻击时需指定攻击的三维坐标点\texttt{CommandCoordinate[3]}，即攻击地图某一坐标的下中上三层的某一层。如果该坐标不在该单位的相应视野范围内，则返回错误值，视为放弃此次攻击。弹药量$\leq 0$时不能发动攻击。弹药在回合结束时到达该坐标产生伤害（即对方可以通过移动回避攻击）。异层攻击不考虑弹药攻击路径；某些情况（具体哪些情况暂未确定）需考虑弹药的攻击路径，若攻击路径上有其他单位，则弹药会击中障碍并产生相应伤害（注意：有友军伤害！）。

    \subsection{补给}
      运输舰、航母、岛屿、基地特有指令，航母、岛屿、基地可以对任意单位补给，运输舰不能补给飞机。补给在移动结束后发动，同样需指定补给目标坐标，对空补给距离为0，对水面补给距离为1，对水下补给距离为0,1。超出范围则视为放弃补给。每次补给补满对方容量，若剩余量不足以补满对方，则全部补充给对方。（这种情况下，运输舰、航母是否需要自动保留一些燃料供自己使用？）

    \subsection{收集}
      运输舰特有指令，从岛屿或资源点获取资源，每次收集补满运输舰容量。收集距离为1。

    \subsection{维修}
      基地特有指令，对空维修距离为0，其余维修距离为1，一次只能维修一个单位，维修补满生命值，补满弹药及燃料。若被维修单位为飞机，则类似于生产操作，可选择维修后的编队配置方案。


  \section{资源与生产系统}
    资源点分为油田和矿场，均在陆地地形上。

    \subsection{油田}
      不可攻击，油储备总量\texttt{TotalFuel}，双方基地附近各有一小油田，地图的中间区域可设大油田，油田储备的燃料只能由运输舰收集获得（不可攻占，但可以派单位在周围保证运输舰运输安全）。

    \subsection{矿产}
      不可攻击，金属储备总量\texttt{TotalMetal}，双方基地附近各有一小矿场，地图的中间区域可设大矿场，矿场储备的金属只能由运输舰收集获得（不可攻占，但可以派单位在周围保证运输舰运输安全）。

    \subsection{生产 Build}
      基地除了常规指令外，额外拥有生产指令，给出各单位对应的编号，若生产飞机编队，还需给出编队配置方案B\texttt{uildFormationNum[4]}。常量：生产飞机编队各机种所需资源及回合 \texttt{BuildFormation[4][4]}


  \section{积分系统}
  \label{sec:score-system}
    积分 = 对敌军造成的伤害 + 占领岛屿（每回合加分）+ 收集的资源量


  \section{伤害计算}


\end{document}
